$(function(){$("body").tooltip({selector:"[rel=tooltip]"})});var app=angular.module("ns_teste1",["ngRoute","ngResource","ngMessages","ngFlash","ui.mask","vtex.ngCurrencyMask"]);app.config(["$httpProvider",function(a){a.interceptors.push("timestampInterceptor")}]),app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"templates/homepage.html"}).when("/api",{templateUrl:"templates/api.html"}).when("/cadastro",{templateUrl:"templates/clients/create.html",controller:"createClientCtrl"}).when("/clientes",{templateUrl:"templates/clients/list.html",controller:"listClientCtrl",resolve:{clients:["$route","Client",function(a,b){return b.query().$promise}]}}).when("/clientes/:id/editar",{templateUrl:"templates/clients/update.html",controller:"updateClientCtrl",resolve:{client:["$route","Client",function(a,b){return b.get({id:a.current.params.id}).$promise}]}}).when("/clientes/:id/editar-senha",{templateUrl:"templates/clients/update_password.html",controller:"updateClientPasswordCtrl",resolve:{client:["$route","Client",function(a,b){return b.get({id:a.current.params.id}).$promise}]}}).when("/clientes/:id/deletar",{templateUrl:"templates/clients/delete.html",controller:"deleteClientCtrl",resolve:{client:["$route","Client",function(a,b){return b.get({id:a.current.params.id}).$promise}]}}).when("/clientes/:id",{templateUrl:"templates/clients/read.html",controller:"readClientCtrl",resolve:{client:["$route","Client",function(a,b){return b.get({id:a.current.params.id}).$promise}]}}).when("/404",{templateUrl:"templates/errors/404.html"}).when("/500",{templateUrl:"templates/errors/500.html"}).otherwise({redirectTo:"404"})}]),app.controller("createClientCtrl",["$scope","$location","Client","Flash",function(a,b,c,d){function e(c){a.isSaving=!0,c.$save(function(a){d.create("success","<strong>Muito bem!</strong> O cliente foi adicionado com sucesso!"),b.path("/clientes/"+a.client.id),b.replace()},function(b){400===b.status&&d.create("danger","<strong>Ooops!</strong> Ocorreu um erro ao salvar o cliente. Tente novamente."),a.isSaving=!1})}a.client=new c,a.isSaving=!1,a.handleSubmit=function(a,b){a.$valid&&e(b)}}]),app.controller("deleteClientCtrl",["$scope","$location","client","Flash",function(a,b,c,d){a.client=c,a.isSaving=!1,a.delete=function(c){a.isSaving=!0,c.$delete(function(a){d.create("success","<strong>Muito bem!</strong> O cliente foi deletado com sucesso!"),b.path("/clientes"),b.replace()},function(b){400===b.status&&d.create("danger","<strong>Ooops!</strong> Ocorreu um erro ao deletar o cliente. Tente novamente."),a.isSaving=!1})}}]),app.controller("listClientCtrl",["$scope","clients",function(a,b){a.clients=b,a.nbClients=b.length}]),app.controller("readClientCtrl",["$scope","client",function(a,b){a.client=b}]),app.controller("updateClientCtrl",["$scope","$location","client","Flash",function(a,b,c,d){function e(c){a.isSaving=!0,c.$save(function(a){d.create("success","<strong>Muito bem!</strong> O cliente foi editado com sucesso!"),b.path("/clientes/"+a.client.id),b.replace()},function(b){400===b.status&&d.create("danger","<strong>Ooops!</strong> Ocorreu um erro ao salvar o cliente. Tente novamente."),a.isSaving=!1})}a.clientCurName=c.name,a.client=c,a.isSaving=!1,a.handleSubmit=function(a,b){a.$valid&&e(b)}}]),app.controller("updateClientPasswordCtrl",["$scope","$location","client","Flash",function(a,b,c,d){function e(c){a.isSaving=!0,c.$save(function(a){d.create("success","<strong>Muito bem!</strong> A senha foi alterada com sucesso!"),b.path("/clientes/"+a.client.id),b.replace()},function(b){400===b.status&&d.create("danger","<strong>Ooops!</strong> Ocorreu um erro ao salvar a nova senha. Tente novamente."),a.isSaving=!1})}a.clientCurName=c.name,a.client=c,a.isSaving=!1,a.handleSubmit=function(a,b){a.$valid&&e(b)}}]),app.directive("currencyMaskNormalize",function(){return{require:"ngModel",restrict:"A",scope:{ngModel:"="},link:function(a,b,c,d){a.ngModel&&(a.ngModel*=100)}}}),app.directive("dateNormalize",function(){return{require:"ngModel",restrict:"A",link:function(a,b,c,d){d.$formatters.push(function(a){return a?new Date(a):null})}}}),app.directive("findAddressByZipcode",["$http","Flash",function(a,b){return{restrict:"A",scope:{address:"="},link:function(c,d,e){c.$watch("address.zipcode",function(d,e){d&&d.match(/(\d{5})[\-](\d{3})/)&&(b.clear(),a.get("api/zip-to-address/"+d).then(function(a){angular.equals([],a.data)?b.create("warning","Não encontramos o enderço desse CEP. Por favor, preencha o formulário manualmente.",0,{container:"flash-address"}):(c.address.route=a.data.route,c.address.neighborhood=a.data.neighborhood,c.address.city=a.data.city,c.address.state=a.data.state)},function(a){b.create("danger","Não foi possível buscar o endereço. Por favor, preencha o formulário manualmente.",0,{container:"flash-address"})}))},!0)}}}]),app.directive("routeResolve",["$rootScope","$location",function(a,b){return{restrict:"E",replace:!0,template:'<div><div class="loading" ng-if="isRouteLoading"></div></div>',link:function(c,d,e){c.isRouteLoading=!1,a.$on("$routeChangeStart",function(){c.isRouteLoading=!0}),a.$on("$routeChangeSuccess",function(){c.isRouteLoading=!1}),a.$on("$routeChangeError",function(a,c,d,e){404===e.status?(b.path("/404"),b.replace()):500===e.status&&(b.path("/500"),b.replace())})}}}]),app.directive("validateCpf",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$validators.cpf=function(a,b){if(!a)return!0;var c=a.replace(/[^0-9]+/g,"");if(11!==c.length||"00000000000"==c||"11111111111"==c||"22222222222"==c||"33333333333"==c||"44444444444"==c||"55555555555"==c||"66666666666"==c||"77777777777"==c||"88888888888"==c||"99999999999"==c)return!1;var d,e,f=0,g=0;for(d=0,e=11;d<=8;d++,e--)f+=c[d]*(e-1),g+=c[d]*e;g+=c[d]*e;var h=f%11<2?0:11-f%11,i=g%11<2?0:11-g%11;return!(h!=c[9]||i!=c[10])}}}}),app.directive("validateEqualsTo",function(){return{restrict:"A",require:"ngModel",scope:{equalsTo:"="},link:function(a,b,c,d){d.$validators.equalsTo=function(b){return!b||angular.equals(b,a.equalsTo)}}}}),app.directive("validateUniqueCpf",["$http","$q",function(a,b){return{restrict:"A",require:"ngModel",scope:{client:"="},link:function(c,d,e,f){f.$asyncValidators.uniqueCpf=function(d,e){return!d||a.get("api/clients?cpf="+d).then(function(a){return 0===a.data.length||(a.data[0].id===c.client.id||b.reject("CPF já cadastrado."))})}}}}]),app.filter("localeDate",function(){return function(a){if(a){var b=new Date(a);return b.toLocaleDateString()}return""}}),app.filter("tel",function(){return function(a){return a?"+55"+a.replace(/[^0-9]+/g,""):""}}),app.factory("timestampInterceptor",function(){return{request:function(a){var b=new RegExp("^templates");if(b.test(a.url)){var c=(new Date).getTime();a.url+="?timestamp="+c}return a}}}),app.factory("Client",["$resource",function(a){return a("api/clients/:id",{id:"@id"})}]);